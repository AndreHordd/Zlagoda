{% extends 'base.html' %}
{% block title %}Працівники — ZLAGODA{% endblock %}
{% set arrow = {'asc':'↑','desc':'↓'} %}

{% block content %}
  <h2>Працівники</h2>

  <!-- ───── Форма фільтрації ───── -->
  <form method="get" class="row g-2 align-items-end mb-3">
    <input type="hidden" name="sort_by" value="{{ sort_by }}">
    <input type="hidden" name="order"   value="{{ order }}">

    <div class="col-md-3">
      <label class="form-label">Посада</label>
      <select name="role" class="form-select">
        <option value=""  {% if not role_filter %}selected{% endif %}>Усі</option>
        <option value="manager"
                {% if role_filter=='manager' %}selected{% endif %}>Менеджер</option>
        <option value="cashier"
                {% if role_filter=='cashier' %}selected{% endif %}>Касир</option>
      </select>
    </div>

    <div class="col-md-4">
      <label class="form-label">Пошук за прізвищем</label>
      <input type="text" name="search" class="form-control"
             placeholder="Введіть прізвище…"
             value="{{ search_filter or '' }}">
    </div>

    <div class="col-auto">
      <button class="btn btn-primary">Застосувати</button>
    </div>
    <div class="col-auto">
      <a href="{{ url_for('manager.employees') }}"
         class="btn btn-outline-secondary">Скинути</a>
    </div>
  </form>

  <p>
    <a href="{{ url_for('manager.new_employee') }}"
       class="btn btn-outline-primary mb-3">
      + Додати працівника
    </a>
  </p>

  {# ───── макрос для клікабельних колонок ───── #}
  {% macro th(col, label) -%}
    <th>
      <a href="{{ url_for('manager.employees',
                           sort_by=col,
                           order=('desc' if sort_by==col and order=='asc' else 'asc'),
                           role=role_filter,
                           search=search_filter) }}">
        {{ label }}
        {% if sort_by == col %} {{ arrow[order] }} {% endif %}
      </a>
    </th>
  {%- endmacro %}

  {% if employees %}
    <table class="table table-striped">
      <thead>
        <tr>
          {{ th('id',        'ID') }}
          {{ th('surname',   'Прізвище') }}
          {{ th('name',      'Ім’я') }}
          {{ th('patronymic','По батькові') }}
          {{ th('role',      'Посада') }}
          {{ th('salary',    'Зарплата') }}
          {{ th('dob',       'Народж.') }}
          {{ th('start',     'Працює з') }}
          {{ th('phone',     'Телефон') }}
          <th>Адреса</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for e in employees %}
          <tr>
            <td>{{ e.id }}</td>
            <td>{{ e.surname }}</td>
            <td>{{ e.name }}</td>
            <td>{{ e.patronymic or '' }}</td>
            <td>{{ e.role }}</td>
            <td>{{ '%.2f'|format(e.salary) }} ₴</td>
            <td>{{ e.date_of_birth }}</td>
            <td>{{ e.date_of_start }}</td>
            <td>{{ e.phone_number }}</td>
            <td>{{ e.city }}, {{ e.street }}, {{ e.zip_code }}</td>
            <td class="text-nowrap">
              <a class="btn btn-sm btn-outline-secondary"
                 href="{{ url_for('manager.edit_employee', emp_id=e.id) }}">
                Редагувати
              </a>
              <form method="post"
                    action="{{ url_for('manager.delete_employee', emp_id=e.id) }}"
                    style="display:inline;"
                    onsubmit="return confirm('Видалити працівника?');">
                <button class="btn btn-sm btn-outline-danger">✕</button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>Працівників не знайдено.</p>
  {% endif %}
{% endblock %}
